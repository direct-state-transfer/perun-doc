<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="680px" preserveAspectRatio="none" style="width:649px;height:680px;" version="1.1" viewBox="0 0 649 680" width="649px" zoomAndPan="magnify"><defs><filter height="300%" id="f8xdo9t2i1qua" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="131" x="261" y="28.708">Register Phase</text><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="187.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192.5" y="376.1797"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="337.5" y="178.5156"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="187.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="337.5" y="376.1797"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="610.5" y="178.5156"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="150.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="610.5" y="413.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="197" x2="197" y1="123.25" y2="247.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="197" x2="197" y1="247.6484" y2="275.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="197" x2="197" y1="275.6484" y2="673.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342.5" x2="342.5" y1="123.25" y2="247.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="342.5" x2="342.5" y1="247.6484" y2="275.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342.5" x2="342.5" y1="275.6484" y2="673.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="615" x2="615" y1="123.25" y2="247.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="615" x2="615" y1="247.6484" y2="275.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="615" x2="615" y1="275.6484" y2="673.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="179" y="119.9482">user</text><ellipse cx="197.5" cy="49.9531" fill="#FEFECE" filter="url(#f8xdo9t2i1qua)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M197.5,57.9531 L197.5,84.9531 M184.5,65.9531 L210.5,65.9531 M197.5,84.9531 L184.5,99.9531 M197.5,84.9531 L210.5,99.9531 " fill="none" filter="url(#f8xdo9t2i1qua)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="318" y="103.6514">Alice's</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="298.5" y="119.9482">Perun Node</text><ellipse cx="342.5" cy="74.6563" fill="#FEFECE" filter="url(#f8xdo9t2i1qua)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="330.5" x2="354.5" y1="88.6563" y2="88.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="598" y="119.9482">SDK</text><ellipse cx="615.5" cy="90.9531" fill="#FEFECE" filter="url(#f8xdo9t2i1qua)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="603.5" x2="627.5" y1="104.9531" y2="104.9531"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="187.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="192.5" y="376.1797"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="337.5" y="178.5156"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="187.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="337.5" y="376.1797"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="610.5" y="178.5156"/><rect fill="#FAFAD2" filter="url(#f8xdo9t2i1qua)" height="150.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="610.5" y="413.3125"/><path d="M288.5,140.25 L636.5,140.25 L636.5,147.25 L626.5,157.25 L288.5,157.25 L288.5,140.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="75.3984" style="stroke:#000000;stroke-width:2.0;" width="354.5" x="288.5" y="140.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="303" x="303.5" y="153.3169">When a final channel update is accepted</text><polygon fill="#556B2F" points="598.5,174.5156,608.5,178.5156,598.5,182.5156,602.5,178.5156" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="347.5" x2="604.5" y1="178.5156" y2="178.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="426" y="173.4497">channel.Register</text><polygon fill="#556B2F" points="353.5,203.6484,343.5,207.6484,353.5,211.6484,349.5,207.6484" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="347.5" x2="614.5" y1="207.6484" y2="207.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="381.5" y="202.5825">State registered on blockchain</text><path d="M9,307.6484 L266,307.6484 L266,314.6484 L256,324.6484 L9,324.6484 L9,307.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="348.8594" style="stroke:#000000;stroke-width:2.0;" width="634" x="9" y="307.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="24" y="320.7153">When channel close is called</text><polygon fill="#00008B" points="325.5,372.1797,335.5,376.1797,325.5,380.1797,329.5,376.1797" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="202.5" x2="331.5" y1="376.1797" y2="376.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="224.5" y="340.8481">Close Channel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="244" y="355.981">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="209.5" y="371.1138">&lt;ClosePayChReq&gt;</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="347.5" x2="394.5" y1="400.3125" y2="400.3125"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="400.3125" y2="413.3125"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="413.3125" y2="413.3125"/><polygon fill="#DC143C" points="363.5,409.3125,353.5,413.3125,363.5,417.3125,359.5,413.3125" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="359.5" y="395.2466">Mark channel state as final</text><polygon fill="#556B2F" points="598.5,443.4453,608.5,447.4453,598.5,451.4453,602.5,447.4453" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="347.5" x2="604.5" y1="447.4453" y2="447.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="359.5" y="442.3794">Send channel update request to peer</text><polygon fill="#556B2F" points="358.5,472.5781,348.5,476.5781,358.5,480.5781,354.5,476.5781" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="352.5" x2="609.5" y1="476.5781" y2="476.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="389.5" y="471.5122">Accepted / Rejected by Peer</text><polygon fill="#556B2F" points="598.5,501.7109,608.5,505.7109,598.5,509.7109,602.5,505.7109" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="347.5" x2="604.5" y1="505.7109" y2="505.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="426" y="500.645">channel.Register</text><polygon fill="#556B2F" points="358.5,530.8438,348.5,534.8438,358.5,538.8438,354.5,534.8438" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="352.5" x2="609.5" y1="534.8438" y2="534.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="381.5" y="529.7778">State registered on blockchain</text><polygon fill="#00008B" points="208.5,559.9766,198.5,563.9766,208.5,567.9766,204.5,563.9766" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="202.5" x2="341.5" y1="563.9766" y2="563.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="219.5" y="558.9106">Channel closed.</text><path d="M19,576.9766 L19,646.9766 L516,646.9766 L516,586.9766 L506,576.9766 L19,576.9766 " fill="#D3D3D3" filter="url(#f8xdo9t2i1qua)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M506,576.9766 L506,586.9766 L516,586.9766 L506,576.9766 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="476" x="25" y="594.0435">Funds are not yet withdrawn, user will receive a channel update notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="25" y="609.1763">once it is done.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="29" y="624.3091"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="25" y="639.4419">See "settle phase" for more details.</text><!--MD5=[91afea5cec1dbbb5e00b1614aefbf466]
@startuml seq_3_register
Title Register Phase

actor user
entity "Alice's\nPerun Node" as perun_node
entity SDK

skinparam sequence {
    messageAlign center
    ArrowThickness 2
    BoxBorderColor Sienna
    BoxBackgroundColor SeaShell
    GroupBodyBackgroundColor transparent
    NoteTextAlignment center
    DefaultTextAlignment center
}
hide footbox

group When a final channel update is accepted

perun_node [#DarkOliveGreen]-> SDK: channel.Register
activate perun_node #LightGoldenRodYellow
activate SDK #LightGoldenRodYellow
perun_node <-[#DarkOliveGreen] SDK: State registered on blockchain
deactivate perun_node
deactivate SDK

'group
end

|||
...
|||

group When channel close is called

user [#DarkBlue]-> perun_node: Close Channel\nRequest\n<ClosePayChReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow

perun_node [#Crimson]-> perun_node: Mark channel state as final
activate SDK #LightGoldenRodYellow
perun_node [#DarkOliveGreen]-> SDK: Send channel update request to peer
perun_node <-[#DarkOliveGreen] SDK: Accepted / Rejected by Peer
perun_node [#DarkOliveGreen]-> SDK: channel.Register
perun_node <-[#DarkOliveGreen] SDK: State registered on blockchain
user <-[#DarkBlue] perun_node: Channel closed.
deactivate user
deactivate perun_node
deactivate SDK

note over user, perun_node #LightGray
Funds are not yet withdrawn, user will receive a channel update notification
once it is done.

See "settle phase" for more details.
endnote

'group
end

@enduml

@startuml seq_3_register
Title Register Phase

actor user
entity "Alice's\nPerun Node" as perun_node
entity SDK

skinparam sequence {
    messageAlign center
    ArrowThickness 2
    BoxBorderColor Sienna
    BoxBackgroundColor SeaShell
    GroupBodyBackgroundColor transparent
    NoteTextAlignment center
    DefaultTextAlignment center
}
hide footbox

group When a final channel update is accepted

perun_node [#DarkOliveGreen]-> SDK: channel.Register
activate perun_node #LightGoldenRodYellow
activate SDK #LightGoldenRodYellow
perun_node <-[#DarkOliveGreen] SDK: State registered on blockchain
deactivate perun_node
deactivate SDK

end

|||
...
|||

group When channel close is called

user [#DarkBlue]-> perun_node: Close Channel\nRequest\n<ClosePayChReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow

perun_node [#Crimson]-> perun_node: Mark channel state as final
activate SDK #LightGoldenRodYellow
perun_node [#DarkOliveGreen]-> SDK: Send channel update request to peer
perun_node <-[#DarkOliveGreen] SDK: Accepted / Rejected by Peer
perun_node [#DarkOliveGreen]-> SDK: channel.Register
perun_node <-[#DarkOliveGreen] SDK: State registered on blockchain
user <-[#DarkBlue] perun_node: Channel closed.
deactivate user
deactivate perun_node
deactivate SDK

note over user, perun_node #LightGray
Funds are not yet withdrawn, user will receive a channel update notification
once it is done.

See "settle phase" for more details.
endnote

end

@enduml

PlantUML version 1.2020.21(Mon Nov 30 22:10:11 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>