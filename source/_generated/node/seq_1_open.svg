<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1949px" preserveAspectRatio="none" style="width:652px;height:1949px;" version="1.1" viewBox="0 0 652 1949" width="652px" zoomAndPan="magnify"><defs><filter height="300%" id="f16xzadfr2p816" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="104" x="276" y="28.708">Open phase</text><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="277.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="208.7813"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="194.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="678.7734"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="101.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="999.2344"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="1359.8281"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="359.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="1559.4922"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="277.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="208.7813"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="194.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="678.7734"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="101.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="999.2344"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="244.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="1204.1641"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="359.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="1559.4922"/><rect fill="#D3D3D3" filter="url(#f16xzadfr2p816)" height="82.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="583.5" y="280.0469"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="583.5" y="1204.1641"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="53.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="583.5" y="1654.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="123.25" y2="526.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="526.1094" y2="554.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="554.1094" y2="895.7031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="895.7031" y2="923.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="923.7031" y2="1115.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="1115.7656" y2="1143.7656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="1143.7656" y2="1455.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="1455.9609" y2="1483.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="1483.9609" y2="1942.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="123.25" y2="526.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="347" x2="347" y1="526.1094" y2="554.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="554.1094" y2="895.7031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="347" x2="347" y1="895.7031" y2="923.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="923.7031" y2="1115.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="347" x2="347" y1="1115.7656" y2="1143.7656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="1143.7656" y2="1455.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="347" x2="347" y1="1455.9609" y2="1483.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="1483.9609" y2="1942.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="588" x2="588" y1="123.25" y2="526.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="588" x2="588" y1="526.1094" y2="554.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="588" x2="588" y1="554.1094" y2="895.7031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="588" x2="588" y1="895.7031" y2="923.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="588" x2="588" y1="923.7031" y2="1115.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="588" x2="588" y1="1115.7656" y2="1143.7656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="588" x2="588" y1="1143.7656" y2="1455.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="588" x2="588" y1="1455.9609" y2="1483.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="588" x2="588" y1="1483.9609" y2="1942.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="40" y="119.9482">user</text><ellipse cx="58.5" cy="49.9531" fill="#FEFECE" filter="url(#f16xzadfr2p816)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M58.5,57.9531 L58.5,84.9531 M45.5,65.9531 L71.5,65.9531 M58.5,84.9531 L45.5,99.9531 M58.5,84.9531 L71.5,99.9531 " fill="none" filter="url(#f16xzadfr2p816)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="304" y="119.9482">perun node</text><ellipse cx="347.5" cy="90.9531" fill="#FEFECE" filter="url(#f16xzadfr2p816)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="335.5" x2="359.5" y1="104.9531" y2="104.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="571" y="119.9482">SDK</text><ellipse cx="588.5" cy="90.9531" fill="#FEFECE" filter="url(#f16xzadfr2p816)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="576.5" x2="600.5" y1="104.9531" y2="104.9531"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="277.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="208.7813"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="194.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="678.7734"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="101.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="999.2344"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="1359.8281"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="359.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="1559.4922"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="277.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="208.7813"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="194.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="678.7734"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="101.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="999.2344"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="244.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="1204.1641"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="359.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="1559.4922"/><rect fill="#D3D3D3" filter="url(#f16xzadfr2p816)" height="82.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="583.5" y="280.0469"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="583.5" y="1204.1641"/><rect fill="#FAFAD2" filter="url(#f16xzadfr2p816)" height="53.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="583.5" y="1654.8906"/><path d="M30,140.25 L285,140.25 L285,147.25 L275,157.25 L30,157.25 L30,140.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="353.8594" style="stroke:#000000;stroke-width:2.0;" width="596" x="30" y="140.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="45" y="153.3169">Outgoing Channel Proposals</text><polygon fill="#00008B" points="330.5,204.7813,340.5,208.7813,330.5,212.7813,334.5,208.7813" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="208.7813" y2="208.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="98.5" y="173.4497">Send Payment Channel Proposal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="188.5825">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="116" y="203.7153">&lt;SendPayChProposalReq&gt;</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="237.9141" y2="237.9141"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="237.9141" y2="250.9141"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="250.9141" y2="250.9141"/><polygon fill="#DC143C" points="363.5,246.9141,353.5,250.9141,363.5,254.9141,359.5,250.9141" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="359.5" y="232.8481">Generate Nonce</text><polygon fill="#556B2F" points="571.5,276.0469,581.5,280.0469,571.5,284.0469,575.5,280.0469" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="352.5" x2="577.5" y1="280.0469" y2="280.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="422.5" y="274.981">dialer.Register</text><polygon fill="#556B2F" points="571.5,305.1797,581.5,309.1797,571.5,313.1797,575.5,309.1797" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="352.5" x2="577.5" y1="309.1797" y2="309.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="397" y="304.1138">client.ProposeChannel</text><path d="M294,324.1797 L364,324.1797 L364,331.1797 L354,341.1797 L294,341.1797 L294,324.1797 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="103.5313" style="stroke:#000000;stroke-width:2.0;" width="322" x="294" y="324.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="309" y="337.2466">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="379" y="336.3901">[if accepted by peer]</text><polygon fill="#556B2F" points="363.5,358.4453,353.5,362.4453,363.5,366.4453,359.5,362.4453" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="357.5" x2="587.5" y1="362.4453" y2="362.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="429" y="357.3794">New Channel</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="406.7109" y2="406.7109"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="406.7109" y2="419.7109"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="419.7109" y2="419.7109"/><polygon fill="#DC143C" points="363.5,415.7109,353.5,419.7109,363.5,423.7109,359.5,419.7109" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="359.5" y="386.5122">Push Channel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="359.5" y="401.645">to Channels</text><polygon fill="#00008B" points="69.5,482.1094,59.5,486.1094,69.5,490.1094,65.5,486.1094" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="346.5" y1="486.1094" y2="486.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="98.5" y="450.7778">Send Payment Channel Proposal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="172" y="465.9106">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="129" y="481.0435">&lt;PayChProposalResp&gt;</text><path d="M10,586.1094 L264,586.1094 L264,593.1094 L254,603.1094 L10,603.1094 L10,586.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1339.7813" style="stroke:#000000;stroke-width:2.0;" width="636" x="10" y="586.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="25" y="599.1763">Incoming Channel Proposals</text><path d="M20,610.2422 L256,610.2422 L256,617.2422 L246,627.2422 L20,627.2422 L20,610.2422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="278.4609" style="stroke:#000000;stroke-width:2.0;" width="486.5" x="20" y="610.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="35" y="623.3091">Subscribe to Notifications</text><polygon fill="#00008B" points="330.5,674.7734,340.5,678.7734,330.5,682.7734,334.5,678.7734" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="678.7734" y2="678.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="71.5" y="643.4419">Subscribe to Payment Channel Proposals</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="658.5747">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="116.5" y="673.7075">&lt;SubPayChProposalsReq&gt;</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="707.9063" y2="707.9063"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="707.9063" y2="720.9063"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="720.9063" y2="720.9063"/><polygon fill="#DC143C" points="363.5,716.9063,353.5,720.9063,363.5,724.9063,359.5,720.9063" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="359.5" y="702.8403">Register Subscription</text><polygon fill="#00008B" points="74.5,776.3047,64.5,780.3047,74.5,784.3047,70.5,780.3047" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="68.5" x2="341.5" y1="780.3047" y2="780.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="75.5" y="744.9731">Subscribe to Payment Channel Updates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="172" y="760.106">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="113" y="775.2388">&lt;SubPayChProposalsResp&gt;</text><path d="M30,820.3047 L107,820.3047 L107,827.3047 L97,837.3047 L30,837.3047 L30,820.3047 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="371" x="30" y="820.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="45" y="833.3716">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="245" x="122" y="832.5151">[Send Cached Notifications (if exists)]</text><polygon fill="#00008B" points="69.5,869.7031,59.5,873.7031,69.5,877.7031,65.5,873.7031" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="346.5" y1="873.7031" y2="873.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="109.5" y="853.5044">Channel Proposal Notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="129.5" y="868.6372">&lt;PayChProposalNotif&gt;</text><path d="M30,930.7031 L304,930.7031 L304,937.7031 L294,947.7031 L30,947.7031 L30,930.7031 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="178.0625" style="stroke:#000000;stroke-width:2.0;" width="491.5" x="30" y="930.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="229" x="45" y="943.77">Unsubscribe from Notifications</text><polygon fill="#00008B" points="330.5,995.2344,340.5,999.2344,330.5,1003.2344,334.5,999.2344" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="999.2344" y2="999.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="82.5" y="963.9028">Unsub to Payment Channel Proposals</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="979.0356">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="108.5" y="994.1685">&lt;UnsubPayChProposalsReq&gt;</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1028.3672" y2="1028.3672"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1028.3672" y2="1041.3672"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1041.3672" y2="1041.3672"/><polygon fill="#DC143C" points="363.5,1037.3672,353.5,1041.3672,363.5,1045.3672,359.5,1041.3672" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="359.5" y="1023.3013">Unregister Subscription</text><polygon fill="#00008B" points="69.5,1096.7656,59.5,1100.7656,69.5,1104.7656,65.5,1100.7656" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="346.5" y1="1100.7656" y2="1100.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="86.5" y="1065.4341">Unsub to Payment Channel Updates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="172" y="1080.5669">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="105" y="1095.6997">&lt;UnsubPayChProposalsResp&gt;</text><path d="M20,1150.7656 L192,1150.7656 L192,1157.7656 L182,1167.7656 L20,1167.7656 L20,1150.7656 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="298.1953" style="stroke:#000000;stroke-width:2.0;" width="596" x="20" y="1150.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="35" y="1163.8325">Send Notification</text><polygon fill="#556B2F" points="363.5,1200.1641,353.5,1204.1641,363.5,1208.1641,359.5,1204.1641" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="357.5" x2="582.5" y1="1204.1641" y2="1204.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="415.5" y="1183.9653">ProposalHandler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="437.5" y="1199.0981">(callback)</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1278.4297" y2="1278.4297"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1278.4297" y2="1291.4297"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1291.4297" y2="1291.4297"/><polygon fill="#DC143C" points="363.5,1287.4297,353.5,1291.4297,363.5,1295.4297,359.5,1291.4297" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359.5" y="1258.231">Push ProposalResponder</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="359.5" y="1273.3638">to ProposalResponders</text><path d="M30,1306.4297 L94,1306.4297 L94,1313.4297 L84,1323.4297 L30,1323.4297 L30,1306.4297 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="135.5313" style="stroke:#000000;stroke-width:2.0;" width="457.5" x="30" y="1306.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="45" y="1319.4966">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="109" y="1318.6401">[if Subscription Exists]</text><polygon fill="#00008B" points="74.5,1355.8281,64.5,1359.8281,74.5,1363.8281,70.5,1359.8281" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="68.5" x2="341.5" y1="1359.8281" y2="1359.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="79" y="1339.6294">Payment Channel Proposal Notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="129.5" y="1354.7622">&lt;PayChProposalNotif&gt;</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="487.5" y1="1398.8281" y2="1398.8281"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1420.9609" y2="1420.9609"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1420.9609" y2="1433.9609"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1433.9609" y2="1433.9609"/><polygon fill="#DC143C" points="363.5,1429.9609,353.5,1433.9609,363.5,1437.9609,359.5,1433.9609" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="359.5" y="1415.895">Cache Notification</text><path d="M20,1490.9609 L242,1490.9609 L242,1497.9609 L232,1507.9609 L20,1507.9609 L20,1490.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="427.9297" style="stroke:#000000;stroke-width:2.0;" width="616" x="20" y="1490.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="35" y="1504.0278">Respond To Notification</text><polygon fill="#00008B" points="330.5,1555.4922,340.5,1559.4922,330.5,1563.4922,334.5,1559.4922" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="1559.4922" y2="1559.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="78" y="1524.1606">Respond To Payment Channel Proposal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="1539.2935">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="117.5" y="1554.4263">&lt;RecvPayChProposalReq&gt;</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1588.625" y2="1588.625"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1588.625" y2="1601.625"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1601.625" y2="1601.625"/><polygon fill="#DC143C" points="363.5,1597.625,353.5,1601.625,363.5,1605.625,359.5,1601.625" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="359.5" y="1583.5591">Pop out from ProposalResponders</text><path d="M30,1616.625 L94,1616.625 L94,1623.625 L84,1633.625 L30,1633.625 L30,1616.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="295.2656" style="stroke:#000000;stroke-width:2.0;" width="596" x="30" y="1616.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="45" y="1629.6919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="109" y="1628.8354">[if timeout not expired]</text><polygon fill="#556B2F" points="571.5,1650.8906,581.5,1654.8906,571.5,1658.8906,575.5,1654.8906" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="352.5" x2="577.5" y1="1654.8906" y2="1654.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="383.5" y="1649.8247">Responder.(Accept/Reject)</text><path d="M294,1669.8906 L364,1669.8906 L364,1676.8906 L354,1686.8906 L294,1686.8906 L294,1669.8906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="103.5313" style="stroke:#000000;stroke-width:2.0;" width="322" x="294" y="1669.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="309" y="1682.9575">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="379" y="1682.1011">[if Accept &amp; no error]</text><polygon fill="#556B2F" points="363.5,1704.1563,353.5,1708.1563,363.5,1712.1563,359.5,1708.1563" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="357.5" x2="587.5" y1="1708.1563" y2="1708.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="429" y="1703.0903">New Channel</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1752.4219" y2="1752.4219"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1752.4219" y2="1765.4219"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1765.4219" y2="1765.4219"/><polygon fill="#DC143C" points="363.5,1761.4219,353.5,1765.4219,363.5,1769.4219,359.5,1765.4219" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="359.5" y="1732.2231">Push Channel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="359.5" y="1747.356">to Channels</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="626" y1="1781.4219" y2="1781.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="35" y="1791.6323">[if timeout expired]</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1831.4922" y2="1831.4922"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1831.4922" y2="1844.4922"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1844.4922" y2="1844.4922"/><polygon fill="#DC143C" points="363.5,1840.4922,353.5,1844.4922,363.5,1848.4922,359.5,1844.4922" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359.5" y="1811.2935">Drop ProposalResponder</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="359.5" y="1826.4263">from ProposalResponders</text><polygon fill="#00008B" points="330.5,1899.8906,340.5,1903.8906,330.5,1907.8906,334.5,1903.8906" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="1903.8906" y2="1903.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="78" y="1868.5591">Respond To Payment Channel Proposal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="172" y="1883.6919">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="114" y="1898.8247">&lt;RecvPayChProposalResp&gt;</text><!--MD5=[b1d053e7179f5796bd2fa0d541da31ff]
@startuml seq_1_open
Title Open phase

actor user
entity "perun node" as perun_node
entity SDK

skinparam sequence {
    messageAlign center
    ArrowThickness 2
    BoxBorderColor Sienna
    BoxBackgroundColor SeaShell
    GroupBodyBackgroundColor transparent
    NoteTextAlignment center
    DefaultTextAlignment center
}
hide footbox

group Outgoing Channel Proposals

user [#DarkBlue]-> perun_node: Send Payment Channel Proposal\nRequest\n<SendPayChProposalReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Generate Nonce
perun_node [#DarkOliveGreen]-> SDK: dialer.Register
activate SDK #LightGrey
perun_node [#DarkOliveGreen]-> SDK: client.ProposeChannel
opt if accepted by peer
perun_node <-[#DarkOliveGreen] SDK: New Channel
deactivate SDK
perun_node [#Crimson]-> perun_node: Push Channel\nto Channels
'if
end
user <-[#DarkBlue] perun_node: Send Payment Channel Proposal\nResponse\n<PayChProposalResp>
deactivate user
deactivate perun_node

'group
end

|||
...
|||

group Incoming Channel Proposals

group Subscribe to Notifications

user [#DarkBlue]-> perun_node: Subscribe to Payment Channel Proposals\nRequest\n<SubPayChProposalsReq>
activate user #LightGoldenRodYellow
activate perun_node  #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Register Subscription
user <-[#DarkBlue] perun_node: Subscribe to Payment Channel Updates\nResponse\n<SubPayChProposalsResp>
|||
loop Send Cached Notifications (if exists)
user <-[#DarkBlue] perun_node: Channel Proposal Notification\n<PayChProposalNotif>
deactivate user
deactivate perun_node
'if
end

'group
end

...

group Unsubscribe from Notifications

user [#DarkBlue]-> perun_node: Unsub to Payment Channel Proposals\nRequest\n<UnsubPayChProposalsReq>
activate user #LightGoldenRodYellow
activate perun_node  #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Unregister Subscription
user <-[#DarkBlue] perun_node: Unsub to Payment Channel Updates\nResponse\n<UnsubPayChProposalsResp>
deactivate user
deactivate perun_node

'group
end

...

group Send Notification

perun_node <-[#DarkOliveGreen] SDK: ProposalHandler\n(callback)
activate SDK #LightGoldenRodYellow
deactivate SDK #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Push ProposalResponder\nto ProposalResponders
alt if Subscription Exists
user <-[#DarkBlue] perun_node: Payment Channel Proposal Notification\n<PayChProposalNotif>
activate user #LightGoldenRodYellow
deactivate user
else
perun_node [#Crimson]-> perun_node: Cache Notification
'if
end
deactivate perun_node

' group
end

...
group Respond To Notification

user [#DarkBlue]-> perun_node: Respond To Payment Channel Proposal\nRequest\n<RecvPayChProposalReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Pop out from ProposalResponders

alt if timeout not expired
perun_node [#DarkOliveGreen]-> SDK: Responder.(Accept/Reject)
activate SDK #LightGoldenRodYellow
opt if Accept & no error
perun_node <-[#DarkOliveGreen] SDK: New Channel
deactivate SDK
perun_node [#Crimson]-> perun_node: Push Channel\nto Channels
'if
end
else if timeout expired
perun_node [#Crimson]-> perun_node: Drop ProposalResponder\nfrom ProposalResponders
user [#DarkBlue]-> perun_node: Respond To Payment Channel Proposal\nResponse\n<RecvPayChProposalResp>
'if
end

deactivate user
deactivate perun_node

'group
end

'group
end

@enduml

@startuml seq_1_open
Title Open phase

actor user
entity "perun node" as perun_node
entity SDK

skinparam sequence {
    messageAlign center
    ArrowThickness 2
    BoxBorderColor Sienna
    BoxBackgroundColor SeaShell
    GroupBodyBackgroundColor transparent
    NoteTextAlignment center
    DefaultTextAlignment center
}
hide footbox

group Outgoing Channel Proposals

user [#DarkBlue]-> perun_node: Send Payment Channel Proposal\nRequest\n<SendPayChProposalReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Generate Nonce
perun_node [#DarkOliveGreen]-> SDK: dialer.Register
activate SDK #LightGrey
perun_node [#DarkOliveGreen]-> SDK: client.ProposeChannel
opt if accepted by peer
perun_node <-[#DarkOliveGreen] SDK: New Channel
deactivate SDK
perun_node [#Crimson]-> perun_node: Push Channel\nto Channels
end
user <-[#DarkBlue] perun_node: Send Payment Channel Proposal\nResponse\n<PayChProposalResp>
deactivate user
deactivate perun_node

end

|||
...
|||

group Incoming Channel Proposals

group Subscribe to Notifications

user [#DarkBlue]-> perun_node: Subscribe to Payment Channel Proposals\nRequest\n<SubPayChProposalsReq>
activate user #LightGoldenRodYellow
activate perun_node  #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Register Subscription
user <-[#DarkBlue] perun_node: Subscribe to Payment Channel Updates\nResponse\n<SubPayChProposalsResp>
|||
loop Send Cached Notifications (if exists)
user <-[#DarkBlue] perun_node: Channel Proposal Notification\n<PayChProposalNotif>
deactivate user
deactivate perun_node
end

end

...

group Unsubscribe from Notifications

user [#DarkBlue]-> perun_node: Unsub to Payment Channel Proposals\nRequest\n<UnsubPayChProposalsReq>
activate user #LightGoldenRodYellow
activate perun_node  #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Unregister Subscription
user <-[#DarkBlue] perun_node: Unsub to Payment Channel Updates\nResponse\n<UnsubPayChProposalsResp>
deactivate user
deactivate perun_node

end

...

group Send Notification

perun_node <-[#DarkOliveGreen] SDK: ProposalHandler\n(callback)
activate SDK #LightGoldenRodYellow
deactivate SDK #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Push ProposalResponder\nto ProposalResponders
alt if Subscription Exists
user <-[#DarkBlue] perun_node: Payment Channel Proposal Notification\n<PayChProposalNotif>
activate user #LightGoldenRodYellow
deactivate user
else
perun_node [#Crimson]-> perun_node: Cache Notification
end
deactivate perun_node

end

...
group Respond To Notification

user [#DarkBlue]-> perun_node: Respond To Payment Channel Proposal\nRequest\n<RecvPayChProposalReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Pop out from ProposalResponders

alt if timeout not expired
perun_node [#DarkOliveGreen]-> SDK: Responder.(Accept/Reject)
activate SDK #LightGoldenRodYellow
opt if Accept & no error
perun_node <-[#DarkOliveGreen] SDK: New Channel
deactivate SDK
perun_node [#Crimson]-> perun_node: Push Channel\nto Channels
end
else if timeout expired
perun_node [#Crimson]-> perun_node: Drop ProposalResponder\nfrom ProposalResponders
user [#DarkBlue]-> perun_node: Respond To Payment Channel Proposal\nResponse\n<RecvPayChProposalResp>
end

deactivate user
deactivate perun_node

end

end

@enduml

PlantUML version 1.2020.21(Mon Nov 30 22:10:11 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>